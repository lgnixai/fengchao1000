import{d as U,x as $,f as D,r as v,n as N,q as t,H as F,h,c as G,e as n,w as u,u as o,aQ as A,R as H,s as b,a as i,t as c,B as R,i as O,aR as T,a7 as j,K,L as Q,M as S,E as Y,Y as z}from"./index-b105d502.js";/* empty css                   *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                *//* empty css                       */import{_ as J}from"./member-benefits.vue_vue_type_script_setup_true_lang-a0021b2f.js";import{_ as W}from"./member-gift.vue_vue_type_script_setup_true_lang-224a4810.js";import{M as X,A as E,N as Z,O as ee}from"./member-7c80ec62.js";const le={class:"main-container"},te={class:"panel-title !text-sm"},ae={class:"w-[150px]"},oe={class:"text-sm text-gray-400 mb-[5px]"},re={class:"panel-title !text-sm"},se={class:"pl-[100px]"},ne={class:"panel-title !text-sm"},ie={class:"pl-[100px]"},me={class:"fixed-footer-wrap"},de={class:"fixed-footer"},Ve=U({__name:"level_edit",setup(ue){const g=$(),x=D(),M=g.meta.title,B=()=>{x.push("/member/level")},V=v(null),y=v(null),_=v(!0),m=v({min:0,max:0}),l=N({level_id:0,level_name:"",remark:"",growth:"",level_benefits:{},level_gifts:{}}),k=v(),L=N({level_name:[{required:!0,message:t("levelNamePlaceholder"),trigger:"blur"}],growth:[{required:!0,message:t("growthPlaceholder"),trigger:"blur"},{validator:(r,e,a)=>{F.digits(l.growth)||a(t("growthFormatError")),l.growth<=0&&a(t("growthNeedGt")+0),m.value.min&&l.growth<=m.value.min&&a(t("growthNeedGt")+m.value.min),m.value.max&&l.growth>=m.value.max&&a(t("growthNeedLt")+m.value.max),a()}}]});g.query.id?X(g.query.id).then(({data:r})=>{Object.assign(l,r),E().then(({data:e})=>{let a=0;e.forEach((d,f)=>{d.level_id==l.level_id&&(a=f)}),e[a-1]&&(m.value.min=e[a-1].growth),e[a+1]&&(m.value.max=e[a+1].growth)}),_.value=!1}):(E().then(({data:r})=>{r[r.length-1]&&(m.value.min=r[r.length-1].growth)}),_.value=!1);const p=v(!1),P=async r=>{p.value||!r||await r.validate(async e=>{var a,d;if(e){if(!await((a=V.value)==null?void 0:a.verify())||!await((d=y.value)==null?void 0:d.verify()))return;p.value=!0,(l.level_id?Z:ee)(l).then(()=>{x.push({path:"/member/level"})}).catch(()=>{p.value=!1})}})};return(r,e)=>{const a=T,d=j,f=K,w=Q,q=S,C=Y,I=z;return h(),G("div",le,[n(d,{class:"card !border-none",shadow:"never"},{default:u(()=>[n(a,{content:o(M),icon:o(A),onBack:e[0]||(e[0]=s=>B())},null,8,["content","icon"])]),_:1}),H((h(),b(d,{class:"box-card mt-[15px] !border-none",shadow:"never"},{default:u(()=>[n(q,{class:"page-form",model:l,"label-width":"120px",ref_key:"formRef",ref:k,rules:L},{default:u(()=>[i("h3",te,c(o(t)("basicInfo")),1),n(w,{label:o(t)("levelName"),prop:"level_name"},{default:u(()=>[n(f,{modelValue:l.level_name,"onUpdate:modelValue":e[1]||(e[1]=s=>l.level_name=s),modelModifiers:{trim:!0},placeholder:o(t)("levelNamePlaceholder"),class:"input-width",maxlength:"20","show-word-limit":"",clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(w,{label:o(t)("remark"),prop:"remark"},{default:u(()=>[n(f,{modelValue:l.remark,"onUpdate:modelValue":e[2]||(e[2]=s=>l.remark=s),modelModifiers:{trim:!0},type:"textarea",placeholder:o(t)("remarkPlaceholder"),class:"input-width",clearable:"",rows:"4",maxlength:"200","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(w,{label:o(t)("growth"),prop:"growth"},{default:u(()=>[i("div",null,[i("div",ae,[n(f,{modelValue:l.growth,"onUpdate:modelValue":e[3]||(e[3]=s=>l.growth=s),modelModifiers:{number:!0,trim:!0},placeholder:o(t)("growthPlaceholder"),clearable:""},null,8,["modelValue","placeholder"])]),i("div",oe,c(o(t)("growthTips")),1)])]),_:1},8,["label"])]),_:1},8,["model","rules"]),i("h3",re,c(o(t)("levelBenefits")),1),i("div",se,[_.value?R("",!0):(h(),b(J,{key:0,ref_key:"benefitsRef",ref:V,modelValue:l.level_benefits,"onUpdate:modelValue":e[4]||(e[4]=s=>l.level_benefits=s)},null,8,["modelValue"]))]),i("h3",ne,c(o(t)("levelGift")),1),i("div",ie,[_.value?R("",!0):(h(),b(W,{key:0,ref_key:"giftRef",ref:y,modelValue:l.level_gifts,"onUpdate:modelValue":e[5]||(e[5]=s=>l.level_gifts=s)},null,8,["modelValue"]))])]),_:1})),[[I,_.value]]),i("div",me,[i("div",de,[n(C,{type:"primary",loading:p.value,onClick:e[6]||(e[6]=s=>P(k.value))},{default:u(()=>[O(c(o(t)("save")),1)]),_:1},8,["loading"])])])])}}});export{Ve as default};
